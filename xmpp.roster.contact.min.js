var Xmpp;(function(n){var i=function(){function t(n,t){n?(this._jid=$(n).attr("jid"),this._item=n,this._name=$(n).attr("name")||Strophe.getNodeFromJid(this.jid),this._subscription=$(n).attr("subscription")||"none",this._ask=$(n).attr("ask")||"",this._groups=$(n).find("group")||{}):(this._jid=t,this._item=n,this._name=Strophe.getNodeFromJid(this.jid),this._subscription="none",this._ask="",this._groups={}),Strophe.debug("Contact created for: "+this.jid),this._resources={},this._vCard={},this._chatSession=null,this._ptype=null}return Object.defineProperty(t.prototype,"jid",{get:function(){return this._jid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"item",{get:function(){return this._item},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subscription",{get:function(){return this._subscription},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ask",{get:function(){return this._ask},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groups",{get:function(){return this._groups},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resources",{get:function(){return this._resources},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vCard",{get:function(){return this._vCard},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"chatSession",{get:function(){return this._chatSession},set:function(n){this._chatSession=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ptype",{get:function(){return this._ptype},enumerable:!0,configurable:!0}),t.prototype.online=function(){var n=!1,t;for(t in this.resources){n=!0;break}return n},t.prototype.update=function(n){var t,i,r,u;this._item=n,t=$(n).attr("name"),Strophe.debug("Contact.update for: "+this.jid),t!==undefined&&this.name!==t&&(this.name=t,$(document).trigger("contactname_changed",this)),i=n.attr("subscription"),i!==undefined&&(this.subscription=i),r=$(n).attr("ask"),r!==undefined&&(this.ask=r),u=$(n).find("group"),u!==undefined&&(this.groups=u)},t.prototype.endChat=function(){var n=$msg({to:this.jid}).c("gone",{xmlns:Strophe.NS.CHATSTATES})},t.prototype.getVCard=function(){},t.prototype.getGroups=function(){var n=[];return this.groups.length===0?"none":(this.groups.each(function(){n.push(this.textContent)}),n.join(", "))},t.prototype.getInfo=function(){var t="offline";return this.resources&&$.each(this.resources,function(i,r){t="["+i+"]",t+=" Status: "+(r.show||"online"),r.status&&(t+=": "+r.status),r.timestamp!==undefined&&(t+=" Updated at: "+n.Util.formatDate(r.timestamp,"{Hours:2}:{Minutes:2} on {Date}/{Month}/{FullYear}"));return}),t},t.prototype.toString=function(){return"jid:"+this.jid+", name:"+this.name+", subscription:"+this.subscription+", groups:"+this.groups.toString()},t}(),t;n.Contact=i,t=function(){function t(n){this.conn=n,this.list=[]}return t.prototype.rosterChanged=function(t){var r=$(t).find("item"),u=r.attr("jid"),f=r.attr("subscription")||"",o=r.attr("ask")||"",i=null,e={};return Strophe.info("rosterChange for: "+u+" ["+f+"]"),this.conn.send($iq({type:"result",id:$(t).attr("id")}).tree()),f==="remove"?(i=new n.Contact(r),delete this.list[u]):(i=this.list[u],i?i.update(r):(i=new n.Contact(r),this.list[u]=i,o===""&&f==="none"?this.conn.send($pres({to:u,type:"subscribe"}).tree()):Strophe.info("rosterChange ignored"))),e[u]=i,$(document).trigger("roster_changed",e),!0},t.prototype.presenceChanged=function(n){var f=$(n).attr("from"),i=Strophe.getBareJidFromJid(f),u,t,r,e,o;if(i===this.conn.me.myJid()||(u=Strophe.getResourceFromJid(f),t=$(n).attr("type")||$(n).find("show").text()||"available",Strophe.info("presenceChange for: "+f+" ["+t+"]"),t==="error"))return!0;if(r=this.list[i],r){if(r.ptype=t,t==="unavailable")try{delete r.resources[u]}catch(s){}else t==="subscribe"?this.conn.send($pres({to:i,type:"subscribed"}).tree()):t==="unsubscribe"?this.conn.send($pres({to:i,type:"unsubscribed"}).tree()):t==="subscribed"||u&&(e=$(n).find("delay").attr("stamp"),o=e===undefined?new Date:new Date(e),r.resources[u]={show:$(n).find("show").text()||"online",status:$(n).find("status").text(),timestamp:o});$(document).trigger("presence_changed",r)}else{if(this.conn.muc.isServer(i))return!0;t==="subscribe"&&$(document).trigger("ask_subscription",i)}return!0},t}(),n.Contacts=t})(Xmpp||(Xmpp={}))